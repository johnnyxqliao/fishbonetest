<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8" />
		<title>Dashboard - Ace Admin</title>

		<meta name="description" content="overview &amp; stats" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />

		<!--basic styles-->

		<link href="assets/css/bootstrap.min.css" rel="stylesheet" />
		<link href="assets/css/bootstrap-responsive.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="assets/css/font-awesome.min.css" />

		<!--[if IE 7]>
		  <link rel="stylesheet" href="assets/css/font-awesome-ie7.min.css" />
		<![endif]-->

		<!--page specific plugin styles-->

		<!--fonts-->

		<link rel="stylesheet" href="assets/css/font.css" />

		<!--ace styles-->

		<link rel="stylesheet" href="assets/css/ace.min.css" />
		<link rel="stylesheet" href="assets/css/ace-responsive.min.css" />
		<link rel="stylesheet" href="assets/css/ace-skins.min.css" />

		<!--[if lte IE 8]>
		  <link rel="stylesheet" href="assets/css/ace-ie.min.css" />
		<![endif]-->

		<script src="dist/cpexcel.js"></script>
		<script src="shim.js"></script>
		<script src="jszip.js"></script>
		<script src="xlsx.js"></script>
    
		
		<!--inline styles related to this page-->
		
		<link rel="stylesheet" href="./css/rightCSS.css" type="text/css" />
        <link rel="stylesheet" href="./css/text.css" type="text/css" />
        <link rel="stylesheet" href="./css/main.css" type="text/css" />
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="./JS/jTopo.js"></script>
        <script type="text/javascript" src="./JS/jquery-min.js"></script>
        <script type="text/javascript" src="./JS/saveImages.js"></script>
        <script type="text/javascript" src="./JS/xlsx.core.min.js"></script>
		
		
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8" /></head>

	<body>
	
		<div class="navbar">
			<div class="navbar-inner">
				<div class="container-fluid">
					<a href="#" class="brand">
						<small>
							<i class="icon-leaf"></i>
							欢迎使用鱼骨图
						</small>
					</a><!--/.brand-->

					<ul class="nav ace-nav pull-right">
						

						

						

						<li class="light-blue">
							<a data-toggle="dropdown" href="#" class="dropdown-toggle">
								<img class="nav-user-photo" src="assets/avatars/user.jpg" alt="Jason's Photo" />
								<span class="user-info">
									<small>Welcome,</small>
									Jason
								</span>

								<i class="icon-caret-down"></i>
							</a>

							<ul class="user-menu pull-right dropdown-menu dropdown-yellow dropdown-caret dropdown-closer">
								<li>
									<a href="#">
										<i class="icon-cog"></i>
										Settings
									</a>
								</li>

								<li>
									<a href="#">
										<i class="icon-user"></i>
										Profile
									</a>
								</li>

								<li class="divider"></li>

								<li>
									<a href="#">
										<i class="icon-off"></i>
										Logout
									</a>
								</li>
							</ul>
						</li>
					</ul><!--/.ace-nav-->
				</div><!--/.container-fluid-->
			</div><!--/.navbar-inner-->
		</div>

		<div class="main-container container-fluid">
			<a class="menu-toggler" id="menu-toggler" href="#">
				<span class="menu-text"></span>
			</a>

			<div class="sidebar" id="sidebar">
				<div class="sidebar-shortcuts" id="sidebar-shortcuts">
					<div class="sidebar-shortcuts-large" id="sidebar-shortcuts-large">
						<button class="btn btn-small btn-success">
							<i class="icon-signal"></i>
						</button>

						<button class="btn btn-small btn-info">
							<i class="icon-pencil"></i>
						</button>

						<button class="btn btn-small btn-warning">
							<i class="icon-group"></i>
						</button>

						<button class="btn btn-small btn-danger">
							<i class="icon-cogs"></i>
						</button>
					</div>

					<div class="sidebar-shortcuts-mini" id="sidebar-shortcuts-mini">
						<span class="btn btn-success"></span>

						<span class="btn btn-info"></span>

						<span class="btn btn-warning"></span>

						<span class="btn btn-danger"></span>
					</div>
				</div><!--#sidebar-shortcuts-->

				<ul class="nav nav-list">
					<li class="active">
						<a href="index.html">
							<i class="icon-dashboard"></i>
							<span class="menu-text"> Dashboard </span>
						</a>
					</li>



					<li>
						<a href="#" class="dropdown-toggle">
							<i class="icon-desktop"></i>
							<span class="menu-text"> UI Elements </span>

							<b class="arrow icon-angle-down"></b>
						</a>

						<ul class="submenu">
							<li>
								<a href="elements.html">
									<i class="icon-double-angle-right"></i>
									Elements
								</a>
							</li>

							<li>
								<a href="buttons.html">
									<i class="icon-double-angle-right"></i>
									Buttons &amp; Icons
								</a>
							</li>

							<li>
								<a href="treeview.html">
									<i class="icon-double-angle-right"></i>
									Treeview
								</a>
							</li>

							<li>
								<a href="#" class="dropdown-toggle">
									<i class="icon-double-angle-right"></i>

									Three Level Menu
									<b class="arrow icon-angle-down"></b>
								</a>

								<ul class="submenu">
									<li>
										<a href="#">
											<i class="icon-leaf"></i>
											Item #1
										</a>
									</li>

									<li>
										<a href="#" class="dropdown-toggle">
											<i class="icon-pencil"></i>

											4th level
											<b class="arrow icon-angle-down"></b>
										</a>

										<ul class="submenu">
											<li>
												<a href="#">
													<i class="icon-plus"></i>
													Add Product
												</a>
											</li>

											<li>
												<a href="#">
													<i class="icon-eye-open"></i>
													View Products
												</a>
											</li>
										</ul>
									</li>
								</ul>
							</li>
						</ul>
					</li>






				</ul><!--/.nav-list-->

				<div class="sidebar-collapse" id="sidebar-collapse">
					<i class="icon-double-angle-left"></i>
				</div>
			</div>

			<div class="main-content">
				<div class="breadcrumbs" id="breadcrumbs">


					<div class="nav-search" id="nav-search">
						<form class="form-search" />
							<span class="input-icon">
								<input type="text" placeholder="Search ..." class="input-small nav-search-input" id="nav-search-input" autocomplete="off" />
								<i class="icon-search nav-search-icon"></i>
							</span>
						</form>
					</div><!--#nav-search-->
				</div>

				<div class="page-content">
					
					
					
					
					
					
					<pre>
Output Format: <select name="format" onchange="setfmt()">
<option value="csv" selected> CSV</option>
<option value="json"> JSON</option>
<option value="form"> FORMULAE</option>
<option value="html"> HTML</option>
</select><br />
<input type="file" name="xlfile" id="xlf" /> 
<b>Advanced Demo Options:</b>
Use Web Workers: (when available) <input type="checkbox" name="useworker" checked>
Use Transferrables: (when available) <input type="checkbox" name="xferable" checked>
Use readAsBinaryString: (when available) <input type="checkbox" name="userabs" checked>
</pre>
<pre id="out"></pre>
<div id="htmlout"></div>
<br/>


	





					<div class="row-fluid">
						
					</div><!--/.row-fluid-->
				</div><!--/.page-content-->

				<div class="ace-settings-container" id="ace-settings-container">
					
				</div><!--/#ace-settings-container-->
			</div><!--/.main-content-->
		</div><!--/.main-container-->

		<a href="#" id="btn-scroll-up" class="btn-scroll-up btn btn-small btn-inverse">
			<i class="icon-double-angle-up icon-only bigger-110"></i>
		</a>

		<!--basic scripts-->

		<!--[if !IE]>-->

		<script src="http://ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>

		<!--<![endif]-->

		<!--[if IE]>


		<!--[if !IE]>-->



		<!--<![endif]-->

		<!--[if IE]>
<script type="text/javascript">
 window.jQuery || document.write("<script src='assets/js/jquery-1.10.2.min.js'>"+"<"+"/script>");
</script>
<![endif]-->

		<script type="text/javascript">
			if("ontouchend" in document) document.write("<script src='assets/js/jquery.mobile.custom.min.js'>"+"<"+"/script>");
		</script>
		<script src="assets/js/bootstrap.min.js"></script>

		<!--page specific plugin scripts-->

<canvas  id="canvas" width="1000" height="500" ></canvas>
		
    <script>
	/*jshint browser:true */
/*global XLSX */
var X = XLSX;
var XW = {
	/* worker message */
	msg: 'xlsx',
	/* worker scripts */
	rABS: './xlsxworker2.js',
	norABS: './xlsxworker1.js',
	noxfer: './xlsxworker.js'
};

var rABS = typeof FileReader !== "undefined" && typeof FileReader.prototype !== "undefined" && typeof FileReader.prototype.readAsBinaryString !== "undefined";
//用来把文件读入内存，并且读取文件中的数据。readAsBinaryString/readAsText/readAsDataURL,typeof判断对象类型是否为未定义
<!-- if(!rABS) { -->
	<!-- document.getElementsByName("userabs")[0].disabled = true; -->
	<!-- document.getElementsByName("userabs")[0].checked = false; -->
<!-- } -->

var use_worker = typeof Worker !== 'undefined';
if(!use_worker) {
	document.getElementsByName("useworker")[0].disabled = true;
	document.getElementsByName("useworker")[0].checked = false;
}

<!-- var transferable = use_worker; -->
<!-- if(!transferable) { -->
	<!-- document.getElementsByName("xferable")[0].disabled = true; -->
	<!-- document.getElementsByName("xferable")[0].checked = false; -->
<!-- } -->

var wtf_mode = false;

function fixdata(data) {
	var o = "", l = 0, w = 10240;
	for(; l<data.byteLength/w; ++l) o+=String.fromCharCode.apply(null,new Uint8Array(data.slice(l*w,l*w+w)));
	o+=String.fromCharCode.apply(null, new Uint8Array(data.slice(l*w)));
	return o;
}

function ab2str(data) {
	var o = "", l = 0, w = 10240;
	for(; l<data.byteLength/w; ++l) o+=String.fromCharCode.apply(null,new Uint16Array(data.slice(l*w,l*w+w)));
	o+=String.fromCharCode.apply(null, new Uint16Array(data.slice(l*w)));
	return o;
}

function s2ab(s) {
	var b = new ArrayBuffer(s.length*2), v = new Uint16Array(b);
	for (var i=0; i != s.length; ++i) v[i] = s.charCodeAt(i);
	return [v, b];
}

function xw_noxfer(data, cb) {
	var worker = new Worker(XW.noxfer);
	worker.onmessage = function(e) {
		switch(e.data.t) {
			case 'ready': break;
			case 'e': console.error(e.data.d); break;
			case XW.msg: cb(JSON.parse(e.data.d)); break;
		}
	};
	var arr = rABS ? data : btoa(fixdata(data));
	worker.postMessage({d:arr,b:rABS});
}

function xw_xfer(data, cb) {
	var worker = new Worker(rABS ? XW.rABS : XW.norABS);
	worker.onmessage = function(e) {
		switch(e.data.t) {
			case 'ready': break;
			case 'e': console.error(e.data.d); break;
			default: xx=ab2str(e.data).replace(/\n/g,"\\n").replace(/\r/g,"\\r"); console.log("done"); cb(JSON.parse(xx)); break;
		}
	};
	if(rABS) {
		var val = s2ab(data);
		worker.postMessage(val[1], [val[1]]);
	} else {
		worker.postMessage(data, [data]);
	}
}

function xw(data, cb) {
	transferable = document.getElementsByName("xferable")[0].checked;
	if(transferable) xw_xfer(data, cb);
	else xw_noxfer(data, cb);
}

function get_radio_value( radioName ) {
	var radios = document.getElementsByName( radioName );
	for( var i = 0; i < radios.length; i++ ) {
		if( radios[i].checked || radios.length === 1 ) {
			return radios[i].value;
		}
	}
}



function to_csv(workbook) {
	var result = [];
	workbook.SheetNames.forEach(function(sheetName) {
		var csv = X.utils.sheet_to_csv(workbook.Sheets[sheetName]);
		if(csv.length > 0){
			result.push("SHEET: " + sheetName);
			result.push("");
			result.push(csv);
		}
	});
	return result.join("\n");
}

function to_formulae(workbook) {
	var result = [];
	workbook.SheetNames.forEach(function(sheetName) {
		var formulae = X.utils.get_formulae(workbook.Sheets[sheetName]);
		if(formulae.length > 0){
			result.push("SHEET: " + sheetName);
			result.push("");
			result.push(formulae.join("\n"));
		}
	});
	return result.join("\n");
}

function to_html(workbook) {
	document.getElementById('htmlout').innerHTML = "";
	var result = [];
	workbook.SheetNames.forEach(function(sheetName) {
		var htmlstr = X.write(workbook, {sheet:sheetName, type:'binary', bookType:'html'});
		document.getElementById('htmlout').innerHTML += htmlstr;
	});
}

function to_json(workbook) {
	var result = {};
	workbook.SheetNames.forEach(function(sheetName) {
		var roa = X.utils.sheet_to_row_object_array(workbook.Sheets[sheetName]);
		if(roa.length > 0){
			result[sheetName] = roa;
		}
	});
	return result;
}

var tarea = document.getElementById('b64data');
function b64it() {
	if(typeof console !== 'undefined') console.log("onload", new Date());
	var wb = X.read(tarea.value, {type: 'base64',WTF:wtf_mode});
	process_wb(wb);
}

var global_wb;
function process_wb(wb) {
	global_wb = wb;
	var output = "";
	switch(get_radio_value("format")) {
		case "json":
			output = JSON.stringify(to_json(wb), 3, 3);
			break;
		case "form":
			output = to_formulae(wb);
			break;
		case "html": return to_html(wb);
		default:
			output = to_csv(wb);
	}
	if(out.innerText === undefined) out.textContent = output;
	else out.innerText = output;
	if(typeof console !== 'undefined') console.log("output", new Date());
}
function setfmt() {if(global_wb) process_wb(global_wb); }



function handleDragover(e) {
	e.stopPropagation();
	e.preventDefault();
	e.dataTransfer.dropEffect = 'copy';
}

var xlf = document.getElementById('xlf');
function handleFile(e) {
	rABS = document.getElementsByName("userabs")[0].checked;
	use_worker = document.getElementsByName("useworker")[0].checked;
	var files = e.target.files;
	var f = files[0];
	{
		var reader = new FileReader();
		var name = f.name;
		reader.onload = function(e) {
			if(typeof console !== 'undefined') console.log("onload", new Date(), rABS, use_worker);
			var data = e.target.result;
			if(use_worker) {
				xw(data, process_wb);
			} else {
				var wb;
				if(rABS) {
					wb = X.read(data, {type: 'binary'});
				} else {
					var arr = fixdata(data);
					wb = X.read(btoa(arr), {type: 'base64'});
				}
				process_wb(wb);
			}
		};
		if(rABS) reader.readAsBinaryString(f);
		else reader.readAsArrayBuffer(f);
	}
}

if(xlf.addEventListener) xlf.addEventListener('change', handleFile, false);

//获取表格中的数据




//画图功能

        //定义一个画布
        var canvas = document.getElementById('canvas');//获取画布id
        var stage = new JTopo.Stage(canvas);//在画布上新建舞台
        var scene = new JTopo.Scene(stage);//å°èå°æ·»å å°åºæ¯ä¸­
        scene.background = './images/background.jpg';   //è®¾ç½®åºæ¯èæ¯å¾ç
        
        //æ·»å åºæ¬é±¼éª¨å¾éª¨æ¶
        function nodefish(x, y, img){
            var node = new JTopo.Node();
            node.setImage('./images/' + img, true);                
            node.setLocation(x, y);
            scene.add(node);
            return node;
        }   
        var fishtail = nodefish(-10,180,'fishtail.jpg');
        var fishconnect = nodefish(138,235,'fishconnect.jpg');
        var fishbrain = nodefish(800,190,'fishbrain.jpg');
        
        
        
        //æ·»å éè¦æ·»å èç¹ä¿¡æ¯å½æ°
var currentText = null;
 function diag() {
        	//æ·»å èç¹ä¿¡æ¯
            var str=prompt("请添加原因","");
            var text = new JTopo.TextNode(str);
            text.setBound(200, 140);
            scene.add(text);
            /* 
                              å é¤èç¹ä¿¡æ¯ 
            */
            text.addEventListener('mouseup', function(event){
                currentText = this;
                handler(event);
            });
            //æ·»å å·¦é®ä¿¡æ¯
            stage.click(function(event){
                if(event.button == 0){// å³é®
                    // å³é­å¼¹åºèåï¼divï¼
                    $("#contextmenu").hide();
                
                }
            }); 
          //å³é®æ§è¡å¨ä½å½æ°
            $("#contextmenu a").click(function(){
                var text = $(this).text();
                
                if(text == '删除'){
                    scene.remove(currentText);
                    currentText = null;
                    $("#contextmenu").hide();
                }if(text == '撤销'){
                	$("#contextmenu").hide();
                    currentText.restore();
                    
                }
            }); 
            
        }
        
         
        //å é¤æ·»å çèç¹ä¿¡æ¯
 function handler(event){
     if(event.button == 2){
         $("#contextmenu").css({
             top: event.pageY,
             left: event.pageX
         }).show();    
     }
 }


     
        
//å½æ°æ§è¡å¥å£
$(document).ready(function(){ 
	
//æ·»å èç¹å½æ°
function node(x, y){
var node = new JTopo.Node();
node.setLocation(x,y);
scene.add(node);
return node;
}

//è®¾ç½®èç¹ç»ç´çº¿å½æ°
function linkNode(nodeA, nodeB, color, width, text){

nodeA.text = text;
nodeA.textPosition = 'Middle_Center';
nodeA.font = 'bold 16px å¾®è½¯éé»';
nodeA.setSize(10, 10);
nodeA.dragable = true;

nodeB.dragable = false;
nodeB.setSize(20, 20);
var link = new JTopo.Link(nodeA,nodeB);
link.strokeColor = color;
link.lineWidth = width;
scene.add(link);
return node;
}


//æ·»å èç¹
var n1 = node(700, 10);
var n2 = node(800, 240);

var n3 = node(450, 10);
var n4 = node(550, 240);

var n5 = node(200, 10);
var n6 = node(300, 240);

var n7 = node(575, 470);
var n8 = node(675, 240);

var n9 = node(325, 470);
var n10 = node(425, 240);

var n11 = node(75, 470);
var n12 = node(175, 240);

//å¼å§è¿çº¿
linkNode(n1, n2,"244,164,96",10, "Man");
linkNode(n3, n4,"244,164,96",10, "Materal");
linkNode(n5, n6,"244,164,96",10, "Environment");
linkNode(n7, n8,"244,164,96",10, "Measure");
linkNode(n9, n10,"244,164,96",10, "Machine");
linkNode(n11, n12,"244,164,96",10, "Method");


var beginNode = null;
var tempNodeA = new JTopo.Node('tempA');;
tempNodeA.setSize(1, 1);

var tempNodeZ = new JTopo.Node('tempZ');;
tempNodeZ.setSize(1, 1);

/* var link = new JTopo.Link(tempNodeA, tempNodeZ); */
var link = new JTopo.FoldLink(tempNodeA, tempNodeZ);
link.direction = 'vertical' || 'horizontal';
link.arrowsRadius = 15; //ç®­å¤´å¤§å°
link.lineWidth = 3; // çº¿å®½
link.bundleOffset = 60; // æçº¿æè§å¤çé¿åº¦
link.bundleGap = 20; // çº¿æ¡ä¹é´çé´é
link.textOffsetY = 3; // ææ¬åç§»éï¼åä¸3ä¸ªåç´ ï¼
link.strokeColor = JTopo.util.randomColor(); // çº¿æ¡é¢è²éæº


scene.mouseup(function(e){
    if(e.button == 2){
        scene.remove(link);
        return;
    }
    if(e.target != null && e.target instanceof JTopo.Node){
        if(beginNode == null){
            beginNode = e.target;
            scene.add(link);
            tempNodeA.setLocation(e.x, e.y);
            tempNodeZ.setLocation(e.x, e.y);
        }else if(beginNode !== e.target){
            var endNode = e.target;
            var l = new JTopo.FoldLink(beginNode, endNode);
            l.direction = 'vertical' || 'horizontal';
            l.arrowsRadius = 15; //ç®­å¤´å¤§å°
            l.lineWidth = 3; // çº¿å®½
            l.bundleOffset = 60; // æçº¿æè§å¤çé¿åº¦
            l.bundleGap = 20; // çº¿æ¡ä¹é´çé´é
            l.textOffsetY = 3; // ææ¬åç§»éï¼åä¸3ä¸ªåç´ ï¼
            l.strokeColor = JTopo.util.randomColor(); // çº¿æ¡é¢è²éæº
            scene.add(l);
            beginNode = null;
            scene.remove(link);
        }else{
            beginNode = null;
        }
    }else{
        scene.remove(link);
    }
});

scene.mousedown(function(e){
    if(e.target == null || e.target === beginNode || e.target === link){
        scene.remove(link);
    }
});
scene.mousemove(function(e){
    tempNodeZ.setLocation(e.x, e.y);
});

var textfield = $("#jtopo_textfield");
scene.dbclick(function(event){
    if(event.target == null)
         return;
    var e = event.target;
    textfield.css({
        top: event.pageY,
        left: event.pageX - e.width/2
    }).show().attr('value', e.text).focus().select();
    e.text = "";
    textfield[0].JTopoNode = e;
});

$("#jtopo_textfield").blur(function(){
    textfield[0].JTopoNode.text = textfield.hide().val();
});

stage.add(scene);
         });
</script>
	
	
	
		<script src="assets/js/jquery-ui-1.10.3.custom.min.js"></script>
		<script src="assets/js/jquery.ui.touch-punch.min.js"></script>
		<script src="assets/js/jquery.slimscroll.min.js"></script>
		<script src="assets/js/jquery.easy-pie-chart.min.js"></script>
		<script src="assets/js/jquery.sparkline.min.js"></script>
		<script src="assets/js/flot/jquery.flot.min.js"></script>
		<script src="assets/js/flot/jquery.flot.pie.min.js"></script>
		<script src="assets/js/flot/jquery.flot.resize.min.js"></script>

		<!--ace scripts-->

		<script src="assets/js/ace-elements.min.js"></script>
		<script src="assets/js/ace.min.js"></script>

		<!--inline scripts related to this page-->
		
<p>
<input type="submit" value="添加原因" name="Su1" onclick="diag()" />
<input type="submit" value="保存图片" name="sav" onclick="convertCanvasToImage()" />
</p>
<textarea id="jtopo_textfield"  onkeydown="if(event.keyCode==13)this.blur();"></textarea>
  <ul id="contextmenu" style="display:none;">	
	<li><a>删除</a></li>
	<li><a>撤销</a></li>
  </ul>
  
  
	</body>
</html>
